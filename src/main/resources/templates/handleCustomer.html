<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Pensionat - Personal</title>

    <link href="css/styles.css" rel="stylesheet" />
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="/">Hem</a>
    </div>
</nav>

<div th:if="${successMessage}" class="alert alert-success text-center" role="alert">
    <span th:text="${successMessage}"></span>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="kunder" th:unless="${#lists.isEmpty(kunder)}">
                <h2 th:text="${pageTitle}" class="mb-3"></h2>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th scope="col">Namn</th>
                        <th scope="col">Email</th>
                        <th scope="col">Telefonnr</th>
                        <th scope="col">Personnummer</th>
                        <th scope="col">Ändra</th>
                        <th scope="col">Ta bort</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="kund : ${kunder}" th:data-customer-id="${kund.id}">
                        <td th:text="${kund.namn}"></td>
                        <td th:text="${kund.email}"></td>
                        <td th:text="${kund.telefonNr}"></td>
                        <td th:text="${kund.personummer}"></td>
                        <td><button class="btn btn-dark edit-btn" data-id="${kund.id}">Ändra</button></td>
                        <td><a th:href="@{/customer/deleteById/{id}(id=${kund.id})}">Ta bort</a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="no-kunder" th:if="${#lists.isEmpty(kunder)}">
                <p th:text="${emptyListMessage}"></p>
            </div>


            <div class="add-customer">
                <h2 class="mb-3">Registrera ny kund</h2>
                <form action="customerCreated" method="post" class="mb-4">
                    <div class="mb-3">
                        <label for="name" class="form-label">Namn:</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email:</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Telefonnr:</label>
                        <input type="text" id="phone" name="phone" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="ssn" class="form-label">Personnr:</label>
                        <input type="text" id="ssn" name="ssn" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-dark">Lägg till</button>
                </form>
            </div>
        </div>
    </div>
</div>

<footer class="py-5 bg-dark">
    <div class="container px-4 px-lg-5"><p class="m-0 text-center text-white">Copyright &copy; 2024</p></div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">

    //Ändrar namn på knappen för att Ändra/spara, samt ändrar bakgrundsfärgerna
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const row = btn.closest('tr');
            const inputs = row.querySelectorAll('td:not(:last-child)');
            const isEditing = btn.textContent.trim() === 'Spara';

            inputs.forEach(input => {
                if (isEditing) {
                    input.contentEditable = false;
                    input.style.backgroundColor = '';
                } else {
                    input.contentEditable = true;
                    input.style.transition = 'background-color 0.5s';
                    input.style.backgroundColor = 'red';
                }
            });

            if (isEditing) {
                btn.textContent = 'Ändra';

                inputs.forEach(input => {
                    input.style.backgroundColor = 'green';

                    setTimeout(() => {
                        input.style.transition = '';
                        input.style.backgroundColor = '';
                    }, 3000);
                });

                //AJAX för att hämta det ändrade datat
                const customerId = row.dataset.customerId;
                const name = inputs[0].textContent.trim();
                const email = inputs[1].textContent.trim();
                const phone = inputs[2].textContent.trim();
                const ssn = inputs[3].textContent.trim();

                //Lägger till och encodar datat
                fetch('/modifyCustomer?id=' + customerId +
                    '&name=' + encodeURIComponent(name) +
                    '&email=' + encodeURIComponent(email) +
                    '&phone=' + encodeURIComponent(phone) +
                    '&ssn=' + encodeURIComponent(ssn), {
                    //POST data som skickas för att sedan hanteras av controllern(modifyCustomer)
                    method: 'POST'
                })
            } else {
                btn.textContent = 'Spara';
            }
        });
    });

</script>

</body>
</html>
